(()=>{"use strict";var e={187:e=>{var t,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}d(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&d(e,"error",t,{once:!0})}(e,i)}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var a=10;function s(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function c(e,t,n,r){var i,o,a,c;if(s(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]),void 0===a)a=o[t]=n,++e._eventsCount;else if("function"==typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(i=l(e))>0&&a.length>i&&!a.warned){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,c=u,console&&console.warn&&console.warn(c)}return e}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=u.bind(r);return i.listener=n,r.wrapFn=i,i}function h(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):y(i,i.length)}function v(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function y(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function d(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){r.once&&e.removeEventListener(t,i),n(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return l(this)},o.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var l=o[e];if(void 0===l)return!1;if("function"==typeof l)r(l,this,t);else{var c=l.length,u=y(l,c);for(n=0;n<c;++n)r(u[n],this,t)}return!0},o.prototype.addListener=function(e,t){return c(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return c(this,e,t,!0)},o.prototype.once=function(e,t){return s(t),this.on(e,f(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,f(this,e,t)),this},o.prototype.removeListener=function(e,t){var n,r,i,o,a;if(s(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},o.prototype.listeners=function(e){return h(this,e,!0)},o.prototype.rawListeners=function(e){return h(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):v.call(e,t)},o.prototype.listenerCount=v,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r={};(()=>{function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(r,{o:()=>ke});var t=function(){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._id=e,this.gameListener=n}var n,r;return n=t,(r=[{key:"id",get:function(){return this._id}},{key:"setGameListener",value:function(e){this.clientListener=e}},{key:"stopGame",value:function(){this.clientListener.onStopGame()}},{key:"listener",get:function(){return this.gameListener}}])&&e(n.prototype,r),t}(),i=new(n(187).EventEmitter),o="PLAYER_ACTION_EVENT";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}var c=function(){function e(t){a(this,e),this.direction=t}return l(e,[{key:"invoke",value:function(e){e.moveCurrentPlayerToDirection(this.direction)}}]),e}(),u=function(){function e(t){a(this,e),this.node=t}return l(e,[{key:"invoke",value:function(e){e.moveCurrentPlayerToNode(this.node)}}]),e}(),f=function(){function e(t){a(this,e),this.wall=t}return l(e,[{key:"invoke",value:function(e){e.placeWall(this.wall)}}]),e}(),h=function(){function e(){a(this,e)}return l(e,null,[{key:"moveToDirection",value:function(e){return new c(e)}},{key:"moveToNode",value:function(e){return new u(e)}},{key:"placeWall",value:function(e){return new f(e)}}]),e}();function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var y=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.points=t,this.requirePointsToBeWithinGameGrid(),this.requirePointsNotToBePlayerPoints(),this.requirePointsToBeLineUp(),this.requireBorderPointsToConnectPlayerNodes()}var t,n,r;return t=e,r=[{key:"create",value:function(t,n){var r=t.move(n,1),i=t.move(n,2);return new e([t,r,i])}}],(n=[{key:"requirePointsToBeWithinGameGrid",value:function(){this.points.forEach((function(e){return e.requireToBeWithinGameGrid()}))}},{key:"requireBorderPointsToConnectPlayerNodes",value:function(){if(!this.points[0].isConnectedWithPlayerPoint()||!this.points[2].isConnectedWithPlayerPoint())throw new Error("First or second point in wall should be connected with at least one PlayerPoint")}},{key:"requirePointsNotToBePlayerPoints",value:function(){if(this.points.some((function(e){return e.isNodePoint()})))throw new Error("Points in wall can`t be player points")}},{key:"requirePointsToBeLineUp",value:function(){if(!this.isAllPointsMakeOneLine())throw new Error("All wall points should be on one line")}},{key:"isAllPointsMakeOneLine",value:function(){return this.allRowsAreEqual()||this.allColumnsAreEqual()}},{key:"allRowsAreEqual",value:function(){var e=this.points[0].row;return this.points.map((function(e){return e.row})).every((function(t){return e===t}))}},{key:"allColumnsAreEqual",value:function(){var e=this.points[0].column;return this.points.map((function(e){return e.column})).every((function(t){return e===t}))}}])&&v(t.prototype,n),r&&v(t,r),e}();function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var p,m,g=function(e){var t,n=e.tagName,r=e.className,i=e.attributes,o=void 0===i?{}:i,a=document.createElement(n);if(r){var s,l=r.split(" ").filter(Boolean);(s=a.classList).add.apply(s,function(e){if(Array.isArray(e))return d(e)}(t=l)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}return Object.keys(o).forEach((function(e){return a.setAttribute(e,o[e])})),a},b=function(e){var t=g({tagName:"div",className:"modal-header"}),n=g({tagName:"span"});return n.innerText=e,t.append(n),t};function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function P(e,t,n){return t&&k(e.prototype,t),n&&k(e,n),e}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.Up=0]="Up",e[e.Right=1]="Right",e[e.Down=2]="Down",e[e.Left=3]="Left"}(m||(m={}));var L=function(){function e(t,n){w(this,e),this.row=t,this.column=n}return P(e,[{key:"scale",value:function(t){return e.create(this.row*t,this.column*t)}},{key:"isNodePoint",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F;return this.isEven()&&this.isWithinGameGrid(e)}},{key:"isEven",value:function(){return this.row%2==0&&this.column%2==0}},{key:"isConnectedWithPlayerPoint",value:function(){return this.neighbors().some((function(e){return e.isNodePoint()}))}},{key:"midPoint",value:function(t){return e.create((this.row+t.row)/2,(this.column+t.column)/2)}},{key:"move",value:function(e,t){var n=C.vector(e);return this.plus(n.row*t,n.column*t)}},{key:"neighbors",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return C.allVectors().map((function(r){return e.create(t.row+r.row*n,t.column+r.column*n)})).filter((function(e){return e.isWithinGameGrid()}))}},{key:"isNeighbor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.neighbors(t).includes(e)}},{key:"isWithinGameGrid",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F;return this.row>=0&&this.column>=0&&this.row<e&&this.column<e}},{key:"requireToBeWithinGameGrid",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F;if(!this.isWithinGameGrid(e))throw new Error("Point is out of game grid: ".concat(JSON.stringify(this)))}},{key:"plus",value:function(t,n){return e.create(t+this.row,n+this.column)}}],[{key:"create",value:function(t,n){var r="".concat(t,":").concat(n),i=this.pool.get(r);return void 0===i&&(i=new e(t,n),this.pool.set(r,i)),i}}]),e}();_(L,"pool",new Map);var C=function(){function e(){w(this,e)}return P(e,null,[{key:"allVectors",value:function(){return Object.values(e.DIRECTIONS)}},{key:"allDirections",value:function(){return[m.Up,m.Left,m.Down,m.Right]}},{key:"vector",value:function(t){return e.DIRECTIONS[t]}}]),e}();function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function N(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}_(C,"DIRECTIONS",(_(p={},m.Up,L.create(-1,0)),_(p,m.Left,L.create(0,-1)),_(p,m.Down,L.create(1,0)),_(p,m.Right,L.create(0,1)),p));var E=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),N(this,"_blockedPoints",new Set),N(this,"_placedWalls",[])}var t,n;return t=e,(n=[{key:"placedWalls",get:function(){return this._placedWalls}},{key:"isBlocked",value:function(e){return this._blockedPoints.has(e)}},{key:"hasConnection",value:function(e,t){var n=e.midPoint(t);return!this.isBlocked(n)}},{key:"placeWall",value:function(e){var t=this;this.requireNotIntersectAlreadyPlacedWalls(e),this._placedWalls.push(e),e.points.forEach((function(e){return t._blockedPoints.add(e)}))}},{key:"removeWall",value:function(e){var t=this;this._placedWalls=this._placedWalls.filter((function(t){return t!==e})),e.points.forEach((function(e){return t._blockedPoints.delete(e)}))}},{key:"intersectPlacedWalls",value:function(e){var t=this;return e.points.some((function(e){return t._blockedPoints.has(e)}))}},{key:"requireNotIntersectAlreadyPlacedWalls",value:function(e){if(this.intersectPlacedWalls(e))throw new Error("Wall shouldn`t intersect already placed walls")}}])&&O(t.prototype,n),e}();function T(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var S,W,G=function(){function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.DEFAULT_WALLS_COUNT;T(this,e),this._finishRow=n,this._id=r,this._currentNode=t,this._remainingWallsCount=i}var t,n;return t=e,(n=[{key:"currentNode",get:function(){return this._currentNode}},{key:"remainingWallsCount",get:function(){return this._remainingWallsCount}},{key:"currentPosition",get:function(){return this._currentNode.position}},{key:"finishRow",get:function(){return this._finishRow}},{key:"id",get:function(){return this._id}},{key:"isFinishReached",value:function(){return this.currentNode.position.row===this._finishRow}},{key:"isFinishNode",value:function(e){return this._finishRow===e.position.row}},{key:"canReachFinishPoint",value:function(){var e=this;return this.currentNode.search((function(t){return e.isFinishNode(t)}))}},{key:"takeWall",value:function(){this.requireToHaveWallsToPlace(),this._remainingWallsCount--}},{key:"hasWallsToPlace",value:function(){return this._remainingWallsCount>0}},{key:"requireToHaveWallsToPlace",value:function(){if(!this.hasWallsToPlace())throw new Error("Player has no more walls")}},{key:"moveTo",value:function(e){this._currentNode=e}}])&&x(t.prototype,n),e}();function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(W="DEFAULT_WALLS_COUNT")in(S=G)?Object.defineProperty(S,W,{value:10,enumerable:!0,configurable:!0,writable:!0}):S[W]=10;var q=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._players=this.createPlayers(t,n,r),this._currentPlayer=this._players[0]}var t,n;return t=e,(n=[{key:"somePlayerWin",value:function(){return this._players.some((function(e){return e.isFinishReached()}))}},{key:"players",get:function(){return this._players}},{key:"currentOpponent",get:function(){return this._currentPlayer===this._players[0]?this._players[1]:this._players[0]}},{key:"currentPlayer",get:function(){return this._currentPlayer}},{key:"nodeHasPlayer",value:function(e){return this._players.some((function(t){return t.currentNode===e}))}},{key:"changeCurrentPlayer",value:function(){var e=this._currentPlayer===this._players[0]?1:0;this._currentPlayer=this._players[e]}},{key:"canPlayersReachFinishPoints",value:function(){return this._players[0].canReachFinishPoint()&&this._players[1].canReachFinishPoint()}},{key:"getPlayer",value:function(e){var t=this._players.find((function(t){return t.currentNode===e}));if(void 0===t)throw new Error("Node: ".concat(JSON.stringify(e)," has no player"));return t}},{key:"createPlayers",value:function(e,t,n){var r=L.create(0,4).scale(2),i=L.create(8,4).scale(2);return[new G(n.getNode(r),16,e),new G(n.getNode(i),0,t)]}}])&&j(t.prototype,n),e}();function R(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var A=function(){function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.position=t,this._graph=n,!t.isNodePoint())throw new Error("Node should have even position")}var t,n;return t=e,(n=[{key:"canMoveToDirection",value:function(e){var t=this.position.move(e,U);return this.isConnectedTo(this._graph.getNode(t))}},{key:"moveToDirection",value:function(e){var t=this.position.move(e,U);if(this.isConnectedTo(this._graph.getNode(t)))return this._graph.getNode(t);throw new Error("Can't move from: ".concat(JSON.stringify(this.position),", to: ").concat(JSON.stringify(t)))}},{key:"search",value:function(e){return this._graph.searchBFS(this,e)}},{key:"hasAnyPathTo",value:function(e){return this._graph.searchBFS(this,(function(t){return t.equals(e)}))}},{key:"equals",value:function(e){return this.position===e.position}},{key:"isConnectedTo",value:function(e){return this._graph.hasConnection(e,this)}},{key:"isNeighbor",value:function(e){return this.position.isNeighbor(e.position,U)}},{key:"allNeighbors",value:function(){var e=this;return this.position.neighbors(U).map((function(t){return e._graph.getNode(t)}))}},{key:"connectedNeighbors",value:function(){var e=this;return this.allNeighbors().filter((function(t){return e.isConnectedTo(t)}))}},{key:"connectedNodes",get:function(){var e=this;return this.neighbors().filter((function(t){return e.isConnectedTo(t)}))}},{key:"neighbors",value:function(){var e=this;return this.position.neighbors(U).map((function(t){return e._graph.getNode(t)}))}}])&&R(t.prototype,n),e}();function D(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var I=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(this,"_nodes",new Map),this._blocker=t;for(var n=0;n<F;n++)for(var r=0;r<F;r++){var i=L.create(n,r);i.isNodePoint()&&this._nodes.set(i,new A(i,this))}}var t,n;return t=e,(n=[{key:"hasConnection",value:function(e,t){var n=e.position.midPoint(t.position);return!this._blocker.isBlocked(n)&&e.isNeighbor(t)}},{key:"getNode",value:function(e){var t=this._nodes.get(e);if(void 0===t)throw new Error("Has no node with position: ".concat(JSON.stringify(e)));return t}},{key:"searchBFS",value:function(e,t){for(var n=[e],r=new Set;0!==n.length;){var i=n.shift();if(t(i))return!0;i.connectedNodes.filter((function(e){return!r.has(e)})).forEach((function(e){r.add(e),n.push(e)}))}return!1}}])&&D(t.prototype,n),e}();function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var B,F=17,H=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(this,"_blocker",new E),this._graph=new I(this._blocker),this._players=new q(t,n,this._graph)}var t,n;return t=e,(n=[{key:"canPlaceWall",value:function(e){return!(this._blocker.intersectPlacedWalls(e)||!this._players.canPlayersReachFinishPoints()||!this.currentPlayer.hasWallsToPlace()||this.isGameOver())}},{key:"placedWalls",get:function(){return this._blocker.placedWalls}},{key:"getNode",value:function(e){return this._graph.getNode(e)}},{key:"moveCurrentPlayerToDirection",value:function(e){this.requireGameIsNotOver(),this.movePlayerToDirection(this._players.currentPlayer,e),this._players.changeCurrentPlayer()}},{key:"moveCurrentPlayerToNode",value:function(e){this.requireGameIsNotOver(),this.allowedNodesToMove().includes(e)&&this._players.currentPlayer.moveTo(e),this._players.changeCurrentPlayer()}},{key:"hasPlayer",value:function(e){return this._players.nodeHasPlayer(this.getNode(e.position))}},{key:"placeWall",value:function(e){this.requireGameIsNotOver(),this._players.currentPlayer.requireToHaveWallsToPlace(),this._blocker.placeWall(e),this.requirePlayersCanReachFinishes(e),this._players.currentPlayer.takeWall(),this._players.changeCurrentPlayer()}},{key:"isGameOver",value:function(){return this._players.somePlayerWin()}},{key:"allowedNodesToMove",value:function(){var e=this,t=this._players.currentPlayer.currentNode;return C.allDirections().map((function(n){return e.moveToDirection(t,n)})).filter((function(e){return void 0!==e}))}},{key:"players",get:function(){return this._players.players}},{key:"winner",get:function(){if(this.isGameOver())return this._players.currentPlayer;throw new Error("Has no winner yet. Game is not over")}},{key:"loser",get:function(){if(this.isGameOver())return this.currentOpponent;throw new Error("Has no loser yet. Game is not over")}},{key:"currentOpponent",get:function(){return this._players.currentOpponent}},{key:"currentPlayer",get:function(){return this._players.currentPlayer}},{key:"getPlayer",value:function(e){return this._players.getPlayer(e)}},{key:"isBlocked",value:function(e){return this._blocker.isBlocked(e)}},{key:"movePlayerToDirection",value:function(e,t){var n=this.moveToDirection(e.currentNode,t);if(void 0===n)throw new Error('Player "'.concat(e.id,"\" can't make step in direction: ").concat(m[t]));e.moveTo(n)}},{key:"moveToDirection",value:function(e,t){if(e.canMoveToDirection(t)){var n=e.moveToDirection(t);return this._players.nodeHasPlayer(n)?this.moveToDirection(n,t):n}}},{key:"requirePlayersCanReachFinishes",value:function(e){if(!this._players.canPlayersReachFinishPoints())throw this._blocker.removeWall(e),new Error("Players should be able to reach their finish lines")}},{key:"requireGameIsNotOver",value:function(){if(this.isGameOver())throw new Error("Game is already over")}}])&&M(t.prototype,n),e}(),U=2;function V(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function z(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){V(o,r,i,a,s,"next",e)}function s(e){V(o,r,i,a,s,"throw",e)}a(void 0)}))}}function J(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e[e.Victory=0]="Victory",e[e.Defeat=1]="Defeat"}(B||(B={}));var Y,K,$=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t,n){t in e?Object.defineProperty(e,t,{value:false,enumerable:!0,configurable:!0,writable:!0}):e[t]=false}(this,"_sessionOver"),this._client1=t,this._client2=n,this._currentClient=t}var t,n,r,i,o,a;return t=e,n=[{key:"startGame",value:(a=z(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._game=new H(this._client1.id,this._client2.id),e.next=3,this.notifyGameStarted();case 3:if(this._game.isGameOver()){e.next=14;break}return e.next=6,this._currentClient.listener.onNextStep(this._game);case 6:if(t=e.sent,!this._sessionOver){e.next=10;break}return this.notifySessionOver(),e.abrupt("return");case 10:t.invoke(this._game),this.changeCurrentClient(),e.next=3;break;case 14:this.sendWinnerGameResult(),this.sendLoserGameResult();case 16:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"notifyGameStarted",value:(o=z(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._client1.listener.onGameStart(this._game),n=this._client1.listener.onGameStart(this._game),e.next=4,Promise.all([t,n]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"sendWinnerGameResult",value:function(){this.getClientById(this._game.winner.id).listener.onGameOver(B.Victory)}},{key:"sendLoserGameResult",value:function(){this.getClientById(this._game.loser.id).listener.onGameOver(B.Defeat)}},{key:"getClientById",value:function(e){if(this._client1.id===e)return this._client1;if(this._client2.id===e)return this._client2;throw new Error("Has no client with such id: ".concat(e))}},{key:"changeCurrentClient",value:function(){this._currentClient=this._currentClient===this._client1?this._client2:this._client1}},{key:"onStopGame",value:function(){this._sessionOver=!0}},{key:"notifySessionOver",value:function(){this._client1.listener.onSessionOver(),this._client1.listener.onSessionOver()}}],r=[{key:"start",value:(i=z(regeneratorRuntime.mark((function t(n,r){var i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=new e(n,r);case 1:if(i._sessionOver){t.next=6;break}return t.next=4,i.startGame();case 4:t.next=1;break;case 6:case"end":return t.stop()}}),t)}))),function(e,t){return i.apply(this,arguments)})}],n&&J(t.prototype,n),r&&J(t,r),e}();function Q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.SELECT_GAME_MODE="Select the game mode"}(K||(K={}));var X,Z=(Q(Y={},B.Victory,"You are winner!"),Q(Y,B.Defeat,"You lost"),Y);function ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var te=(ee(X={},B.Victory,"./img/win.png"),ee(X,B.Defeat,"./img/pngwing.com.png"),X),ne=function(e){var t,n,r,i,o,a,s,l;n=(t={title:Z[e],bodyElement:(l=te[e],a='\n<div class="result-image-wrapper">\n<img class="result-image" src="'.concat(l,'" alt="">\n<button class="modal-button" id="restart-button">Restart</button>\n</div>\n'),s=g({tagName:"div",className:"modal-body-content-wrapper"}),s.innerHTML=a,s)}).title,r=t.bodyElement,i=document.getElementById("modal"),o=function(e){var t=e.title,n=e.bodyElement,r=g({tagName:"div",className:"modal-layer"}),i=g({tagName:"div",className:"modal-container"}),o=b(t);return i.append(o,n),r.append(i),r}({title:n,bodyElement:r}),null==i||i.append(o);var c=document.getElementById("restart-button");null==c||c.addEventListener("click",(function(){return function(){var e=document.getElementsByClassName("modal-layer")[0];e&&e.remove()}()}))};function re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ie,oe,ae=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,(n=[{key:"onSessionOver",value:function(){}},{key:"onGameStart",value:function(e){return ke(e.currentPlayer.currentPosition.column,e.currentPlayer.currentPosition.row,e.currentOpponent.currentPosition.column,e.currentOpponent.currentPosition.row),Promise.resolve()}},{key:"onGameOver",value:function(e){ne(e)}},{key:"onNextStep",value:function(e){return ke(e.currentPlayer.currentPosition.column,e.currentPlayer.currentPosition.row,e.currentOpponent.currentPosition.column,e.currentOpponent.currentPosition.row),new Promise((function(t){i.on(o,(function n(r,a){if(a)t(h.placeWall(y.create(r,a)));else{if(!e.allowedNodesToMove().includes(e.getNode(r)))return;t(h.moveToNode(e.getNode(r)))}i.off(o,n)}))}))}}])&&re(t.prototype,n),e}();function se(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function le(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal"}(oe||(oe={}));var ce=(le(ie={},oe.Horizontal,m.Right),le(ie,oe.Vertical,m.Down),ie),ue=[oe.Horizontal,oe.Vertical],fe=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),le(this,"currentField",null),this.position=t,this.wallsCount=n}var t,n;return t=e,(n=[{key:"setPosition",value:function(e){this.position=e}},{key:"setWallsCount",value:function(e){this.wallsCount=e}},{key:"randomMove",value:function(e,t){return Math.random()>.7&&this.wallsCount>0?this.placeWall(t):this.makeMove(e)}},{key:"makeMove",value:function(e){var t=e[this.randomInteger(0,e.length-1)];return h.moveToNode(t)}},{key:"setFieldState",value:function(e){this.currentField=e}},{key:"placeWall",value:function(e){var t=this.getWallPosition(),n=this.getWallPosition(),r=ue[this.randomInteger(0,ue.length-1)];r===oe.Horizontal?n--:t--;var i=L.create(t,n),o=ce[r],a=y.create(i,o);return e(a)?(this.wallsCount--,h.placeWall(a)):this.placeWall(e)}},{key:"getWallPosition",value:function(){return 2*this.randomInteger(0,7)+1}},{key:"randomInteger",value:function(e,t){var n=e-.5+Math.random()*(t-e+1);return Math.round(n)}}])&&se(t.prototype,n),e}();function he(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ve,ye,de,pe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t,n){t in e?Object.defineProperty(e,t,{value:null,enumerable:!0,configurable:!0,writable:!0}):e.bot=null}(this,"bot")}var t,n;return t=e,(n=[{key:"onSessionOver",value:function(){}},{key:"onGameStart",value:function(e){return this.bot=new fe(e.currentPlayer.currentPosition,e.currentPlayer.remainingWallsCount),Promise.resolve()}},{key:"onGameOver",value:function(){this.bot=null}},{key:"onNextStep",value:function(e){var t;return Promise.resolve(null===(t=this.bot)||void 0===t?void 0:t.randomMove(e.allowedNodesToMove(),e.canPlaceWall.bind(e)))}}])&&he(t.prototype,n),e}();console.log("dhjjfjvjf");var me,ge,be=[],we=function e(t,n,r,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t,this.y=n,this.value=r,this.wallv=i,this.wallh=o},ke=function(e,t,n,r){for(var i=0;i<17;i++){be[i]=[];for(var o=0;o<17;o++)i%2==0&&o%2!=0?be[i].push(new we(o,i,0,!0,!1)):i%2!=0&&o%2==0?be[i].push(new we(o,i,0,!1,!0)):be[i].push(new we(o,i,0,!1,!1))}be[e][t].value=1,be[n][r].value=2;var a=document.getElementById("game_container");a.innerHTML="";for(var s="",l=0;l<17;l++){s+='<div class="row">';for(var c=0;c<17;c++){var u=be[l][c],f="";1===u.value&&(f="player1"),2===u.value&&(f="player2"),u.wallh&&(f="wallh"),u.wallv&&(f="wallv"),s+=c%2!=0&&l%2!=0?"<div class='cell ".concat(f,"' id='cell11' data-x='").concat(c,"'\n        data-y='").concat(l,"'></div>"):c%2==0&&l%2!=0?"<div class='cell ".concat(f,"' id='cell01' data-x='").concat(c,"'\n        data-y='").concat(l,"'></div>"):c%2!=0&&l%2==0?"<div class='cell ".concat(f,"' id='cell10' data-x='").concat(c,"'\n        data-y='").concat(l,"'></div>"):"<div class='cell ".concat(f,"' id='cell' data-x='").concat(c,"'\n        data-y='").concat(l,"'></div>")}s+="</div>"}a.innerHTML=s};null===(ve=document.getElementById("game_container"))||void 0===ve||ve.addEventListener("click",(function(e){var t,n,r,a,s,l,c,u,f,h,v,y=e.target,d=[],p=+y.getAttribute("data-x"),g=+y.getAttribute("data-y");if(p>0&&(n=p-1),p<16&&(a=p+1),g>0&&(c=g-1),g<16&&(f=g+1),p>1&&(r=p-2),p<15&&(s=p+2),g>1&&(u=g-2),g<15&&(h=g+2),p<14&&(l=p+2),g<14&&(v=g+2),y.classList.contains("player1")||y.classList.contains("player2")){var b=document.querySelector(".cell[data-x='".concat(p,"'][data-y='").concat(c,"']")),w=document.querySelector(".cell[data-x='".concat(p,"'][data-y='").concat(f,"']")),k=document.querySelector(".cell[data-x='".concat(n,"'][data-y='").concat(g,"']")),P=document.querySelector(".cell[data-x='".concat(a,"'][data-y='").concat(g,"']"));null!=b&&b.classList.contains("set")||d.push(document.querySelector(".cell[data-x='".concat(p,"'][data-y='").concat(u,"']"))),null!=w&&w.classList.contains("set")||d.push(document.querySelector(".cell[data-x='".concat(p,"'][data-y='").concat(h,"']"))),null!=k&&k.classList.contains("set")||d.push(document.querySelector(".cell[data-x='".concat(r,"'][data-y='").concat(g,"']"))),null!=P&&P.classList.contains("set")||d.push(document.querySelector(".cell[data-x='".concat(s,"'][data-y='").concat(g,"']")));for(var _=0;_<d.length;_++)"rgb(0, 0, 128)"===d[_].style.backgroundColor?d[_].style.backgroundColor="#1c1cf0":d[_].style.backgroundColor="#000080"}else if(y.classList.contains("wallv")){var C,O,N;t=m.Down,y.classList.add("set"),null===(C=document.querySelector(".cell[data-x='".concat(p,"'][data-y='").concat(f,"']")))||void 0===C||C.classList.add("wallv"),null===(O=document.querySelector(".cell[data-x='".concat(p,"'][data-y='").concat(f,"']")))||void 0===O||O.classList.add("set"),null===(N=document.querySelector(".cell[data-x='".concat(p,"'][data-y='").concat(v,"']")))||void 0===N||N.classList.add("set")}else if(y.classList.contains("wallh")){var E,T,x;t=m.Right,y.classList.add("set"),null===(E=document.querySelector(".cell[data-x='".concat(a,"'][data-y='").concat(g,"']")))||void 0===E||E.classList.add("wallh"),null===(T=document.querySelector(".cell[data-x='".concat(a,"'][data-y='").concat(g,"']")))||void 0===T||T.classList.add("set"),null===(x=document.querySelector(".cell[data-x='".concat(l,"'][data-y='").concat(g,"']")))||void 0===x||x.classList.add("set")}i.emit(o,L.create(p,g),t)})),null===(ye=document.getElementById("game_container"))||void 0===ye||ye.addEventListener("mouseover",(function(e){var t=e.target,n=+t.getAttribute("data-x"),r=+t.getAttribute("data-y"),i=r+1,o=r+2,a=n+1,s=n+2,l=document.querySelector(".cell[data-x='".concat(n,"'][data-y='").concat(i,"']")),c=document.querySelector(".cell[data-x='".concat(n,"'][data-y='").concat(o,"']")),u=document.querySelector(".cell[data-x='".concat(a,"'][data-y='").concat(r,"']")),f=document.querySelector(".cell[data-x='".concat(s,"'][data-y='").concat(r,"']"));!t.classList.contains("wallv")||16===r||t.classList.contains("set")||l.classList.contains("set")||c.classList.contains("set")?!t.classList.contains("wallh")||16===n||t.classList.contains("set")||u.classList.contains("set")||f.classList.contains("set")||(t.style.backgroundColor="#000080",u.style.backgroundColor="#000080",f.style.backgroundColor="#000080"):(t.style.backgroundColor="#000080",l.style.backgroundColor="#000080",c.style.backgroundColor="#000080")})),null===(de=document.getElementById("game_container"))||void 0===de||de.addEventListener("mouseout",(function(e){var t=e.target,n=+t.getAttribute("data-x"),r=+t.getAttribute("data-y"),i=r+1,o=r+2,a=n+1,s=n+2,l=document.querySelector(".cell[data-x='".concat(n,"'][data-y='").concat(i,"']")),c=document.querySelector(".cell[data-x='".concat(n,"'][data-y='").concat(o,"']")),u=document.querySelector(".cell[data-x='".concat(a,"'][data-y='").concat(r,"']")),f=document.querySelector(".cell[data-x='".concat(s,"'][data-y='").concat(r,"']"));!t.classList.contains("wallv")||t.classList.contains("set")||l.classList.contains("set")||c.classList.contains("set")?!t.classList.contains("wallh")||t.classList.contains("set")||u.classList.contains("set")||f.classList.contains("set")||(t.style.backgroundColor="royalblue",u.style.backgroundColor="royalblue",f.style.backgroundColor="royalblue"):(t.style.backgroundColor="royalblue",l.style.backgroundColor="royalblue",c.style.backgroundColor="royalblue")})),me=new t("1",new ae),ge=new t("2",new pe),$.start(me,ge)})()})();